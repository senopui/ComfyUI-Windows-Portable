name: "Test Build (No Upload)"

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
        - uses: actions/checkout@v6

        - name: Stage 1 Gathering Dependencies
          shell: bash
          working-directory: builder
          run: bash stage1.sh

        - name: Stage 2 Assembling Repositories
          shell: bash
          working-directory: builder
          run: bash stage2.sh

        - name: Validate workflow fixture
          shell: pwsh
          run: ./builder/ComfyUI_Windows_portable/python_standalone/python.exe -s -B scripts/qa_validate_workflow.py --root "$PWD"

        - name: QA Smoke Test (CPU)
          shell: pwsh
          run: ./scripts/qa_smoketest_windows.ps1 -RootPath "$PWD" -Mode cpu
